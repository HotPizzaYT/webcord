<html>

<head>
<meta http-equiv="Content-Language" content="en-us">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
<title>The WebCord client for Discord</title>
<script>
var window.int;
function disSend(t, c, m){
clearInterval(window.int)
fetch("https://ptb.discordapp.com/api/v6/channels/" + c + "/messages", {"credentials":"include","headers":{"accept":"*/*","accept-language":"en-US","authorization": t,"content-type":"application/json","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-super-properties":"hax"},"referrer":"https://ptb.discordapp.com/channels/@me","referrerPolicy":"no-referrer-when-downgrade","body":"{\"content\":\"" + m + "\",\"tts\":false}","method":"POST","mode":"cors"});
document.getElementById('mess').value = "";
disUpdate(document.getElementById('token').value, c, '50');
window.int = setInterval(function(){ disUpdate(document.getElementById('token').value, c, '50'); }, 9000);
}

function disLoad(t, v){
document.getElementById('messages').innerHTML = "";


fetch('https://discordapp.com/api/v6/users/@me/channels', {"credentials":"include","headers":{"accept":"*/*","accept-language":"en-US","authorization": t},"referrer":"https://discordapp.com/api/v6/","referrerPolicy":"no-referrer-when-downgrade","method":"GET","mode":"cors"}).then((response) => {     return response.json();   })   .then((data) => { 
    for(let i=0; i < data.length; i++){
        var sel = document.getElementById('ids_dm');
        var opt = document.createElement('option');

        opt.appendChild( document.createTextNode(data[i].recipients[0].username) );

        opt.value = data[i].id; 

        sel.appendChild(opt); 
    }
})

}

function disUpdate(t, c, v) {
    document.getElementById('messages').innerHTML = '';


    fetch('https://ptb.discordapp.com/api/v6/channels/' + c + '/messages?limit=' + v, {"credentials":"include","headers":{"accept":"*/*","accept-language":"en-US","authorization":t,"sec-fetch-mode":"cors","sec-fetch-site":"same-origin"},"referrer":"https://ptb.discordapp.com/channels/@me","referrerPolicy":"no-referrer-when-downgrade","body":null,"method":"GET","mode":"cors"}).then((response) => {     return response.json();   })   .then((data) => {   i = 0; for(let i = 0 ; i < data.length; i++){  

// + '<img src="' + data[i].attachments[0].url + '" style="width: 10%; height: 10%" /><br>'


if(data[i].attachments == ''){
 document.getElementById('messages').innerHTML += "<b>" + data[i].author.username + "</b> " + data[i].content + '<br>';
 } else {
//document.getElementById('messages').innerHTML += "<b>" + data[i].author.username + "</b> " + data[i].content + '<br>' + '<img src="' + data[i].attachments[0].url + '" alt="Download \'' + data[i].attachments[0].filename + '\'" /><br>'; 
 console.log('Found a URL');
 }
} });
}



function getChannel(){
    var e = document.getElementById("ids_dm");
    return e.options[e.selectedIndex].value;
}    



function keyD(event){
if(event.keyCode == 13){
disSend(document.getElementById('token').value, getChannel(), document.getElementById('mess').value);
}
}
</script>
</head>

<body>

<div style="position: absolute; width: 1007px; height: 469px; z-index: 1; left: 6px; top: 15px; color: #ffffff; background-color: #000000;" id="layer1">
WebCord Client========================<br>
<input type="password" id="token" placeholder="Put your token here" size="42"></input> 
<button onclick="disLoad(document.getElementById('token').value, '50')">Load all DMs!</button>

<label for="ids_dm">Pick DM</label>

<select id="ids_dm" onchange="disUpdate(document.getElementById('token').value, getChannel(), '50')">
    <option value="test">Test DM Option</option>
</select> 

<div style="position: absolute; width: 975px; height: 350px; z-index: 2; left: 14px; top: 68px; color: #000000; background-color: #ffffff; padding: 5px; overflow-y: scroll; overflow-x: scroll;" id="messages">

<b>undefined</b> this is what your messages will look like</div>

<div style="position: absolute; width: 982px; height: 38px; z-index: 3; left: 10px; top: 432px" id="layer2">
<input id="mess" placeholder="Send message to Undefined" onkeypress="keyD(event)" size="130"></input>&nbsp;<button onclick="disSend(document.getElementById('token').value, getChannel(), document.getElementById('mess').value)">Send</button>
&nbsp;</div>

</body>

</html>
